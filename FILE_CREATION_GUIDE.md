# Руководство по надежному созданию файлов

## Проблема

При использовании heredoc (cat << EOF) для создания файлов через terminal часто происходят зависания или прерывания команд. Это особенно проблематично при создании PHP файлов с большим количеством специальных символов.

## Решения

### 1. Используйте edit_file вместо terminal команд ✅ (РЕКОМЕНДУЕТСЯ)

```python
# Всегда предпочитайте edit_file для создания новых файлов
edit_file(
    target_file="path/to/file.php",
    instructions="Create new file",
    code_edit="<?php\n// file content"
)
```

### 2. Используйте echo для коротких файлов

```bash
echo '<?php
declare(strict_types=1);
// content' > file.php
```

### 3. Используйте printf для файлов с escape-последовательностями

```bash
printf '<?php\ndeclare(strict_types=1);\n\nclass Test {}\n' > file.php
```

### 4. Используйте наш helper скрипт create-file.sh

```bash
echo '<?php
// content' | ./create-file.sh path/to/file.php
```

### 5. Создавайте пустой файл, затем используйте edit_file

```bash
touch path/to/file.php
# Затем используйте edit_file для добавления содержимого
```

## Почему происходят зависания с heredoc?

1. **Специальные символы**: PHP код содержит много $, \, ", ' которые интерпретируются shell
2. **Многострочный ввод**: Terminal может неправильно обрабатывать длинные многострочные вводы
3. **EOF маркер**: Если EOF не на отдельной строке или есть пробелы, команда не завершится
4. **Буферизация**: Большие блоки текста могут вызывать проблемы с буферизацией

## Рекомендации

1. **ВСЕГДА используйте edit_file** для создания новых файлов с кодом
2. Используйте terminal команды только для:
   - Создания директорий (mkdir)
   - Проверки существования файлов (ls, test -f)
   - Запуска скриптов
   - Простых операций без специальных символов

3. Если нужно использовать terminal для создания файла:
   - Сначала создайте пустой файл: `touch filename`
   - Затем используйте edit_file для добавления содержимого

## Примеры правильного использования

### ❌ Неправильно:
```bash
cat > file.php << 'EOF'
<?php
class Test {
    private $var = "value";
}
EOF
```

### ✅ Правильно:
```python
edit_file(
    target_file="file.php",
    instructions="Create PHP class file",
    code_edit="""<?php

class Test {
    private $var = "value";
}"""
)
```

## Обновление методологии

Это руководство должно быть добавлено в:
- `.cursorrules` - раздел о создании файлов
- `technical_requirements/antipatterns.md` - как антипаттерн использования heredoc 