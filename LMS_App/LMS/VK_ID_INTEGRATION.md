# Интеграция VK ID в LMS iOS приложение

## Обзор

Приложение LMS теперь использует VK ID для авторизации пользователей вместо Active Directory. После авторизации через VK, пользователи должны быть одобрены администратором для получения доступа к курсам.

## Архитектура

### Процесс авторизации

1. **Вход через VK ID**
   - Пользователь нажимает "Войти через VK ID"
   - Открывается VK авторизация
   - После успешной авторизации данные отправляются на backend

2. **Ожидание одобрения**
   - Новые пользователи попадают в статус "ожидает одобрения"
   - Показывается экран `PendingApprovalView`
   - Автоматическая проверка статуса каждые 30 секунд

3. **Одобрение администратором**
   - Администраторы видят раздел "Новые студенты" в меню "Ещё"
   - Могут выбрать несколько пользователей и одобрить их
   - После одобрения пользователи получают доступ к курсам

## Компоненты

### Services
- `VKIDAuthService` - управление авторизацией через VK ID
- `AdminService` - административные функции

### Views
- `VKLoginView` - экран входа через VK ID
- `PendingApprovalView` - экран ожидания одобрения
- `PendingUsersView` - админ-панель для одобрения новых студентов

### Models
- `VKAuthRequest/Response` - модели для авторизации
- `PendingUser` - модель ожидающего одобрения пользователя
- `ApproveUsersRequest/Response` - модели для одобрения

## Настройка

### 1. Установка зависимостей

```bash
cd LMS_App/LMS
pod install
```

### 2. Конфигурация VK App

1. Зарегистрируйте приложение на https://vk.com/dev
2. Получите App ID и Client Secret
3. Обновите `AppConfig.swift`:

```swift
static let vkAppId = "YOUR_VK_APP_ID"
static let vkClientSecret = "YOUR_CLIENT_SECRET"
```

### 3. Обновление Info.plist

Info.plist уже настроен с необходимыми URL схемами:
- `vkauthorize`
- `vk`
- `vk-share`
- `vkid`

URL схема приложения: `vk51920596` (замените на ваш App ID)

## Backend API

### Новые endpoints

1. **POST /auth/vk** - авторизация через VK
   ```json
   {
     "vk_id": "123456789",
     "access_token": "vk_access_token",
     "email": "user@example.com",
     "first_name": "Иван",
     "last_name": "Иванов",
     "avatar": "https://vk.com/avatar.jpg"
   }
   ```

2. **GET /admin/users/pending** - список ожидающих одобрения
   ```json
   [
     {
       "id": "user_id",
       "vk_id": "123456789",
       "email": "user@example.com",
       "first_name": "Иван",
       "last_name": "Иванов",
       "avatar": "https://vk.com/avatar.jpg",
       "registered_at": "2025-06-25T10:00:00Z"
     }
   ]
   ```

3. **POST /admin/users/approve** - одобрить пользователей
   ```json
   {
     "user_ids": ["user_id_1", "user_id_2"]
   }
   ```

## Безопасность

1. **Токены хранятся в Keychain** - безопасное хранилище iOS
2. **VK токены не хранятся локально** - только токены от нашего backend
3. **Проверка прав администратора** - на уровне backend и frontend

## Тестирование

### Тестовый VK App
- App ID: 51920596
- Для тестирования можно использовать тестовые аккаунты VK

### Процесс тестирования
1. Войдите через VK ID
2. Проверьте экран ожидания одобрения
3. Войдите как администратор в другой сессии
4. Одобрите нового пользователя
5. Проверьте, что пользователь получил доступ

## Известные проблемы

1. **VK SDK требует iOS 12.4+** - минимальная версия iOS повышена
2. **Необходим реальный device для тестирования VK авторизации** - в симуляторе может не работать

## Будущие улучшения

1. Добавить push-уведомления при одобрении
2. Массовое одобрение/отклонение пользователей
3. Фильтрация и поиск в админ-панели
4. Экспорт списка ожидающих в CSV 