# Реализация фильтрации курсов (Course Filter)

## Обзор

Реализована расширенная система фильтрации курсов для Course Management в рамках Фазы 2.

## Компоненты

### 1. CourseFilterViewModel
**Файл**: `ViewModels/CourseFilterViewModel.swift`

- Управляет состоянием всех фильтров
- Поддерживает сохранение/восстановление состояния
- Фильтрует курсы по множественным критериям

**Основные свойства**:
- `selectedStatus`: Фильтр по статусу (draft/published/archived)
- `showOnlyCmi5/showOnlyRegular`: Фильтр по типу курса
- `showOnlyWithModules/showOnlyWithoutModules`: Фильтр по наличию модулей
- `showOnlyWithCompetencies/showOnlyWithoutCompetencies`: Фильтр по компетенциям

### 2. CourseFilterView
**Файл**: `Views/CourseFilterView.swift`

- Модальное окно с настройками фильтров
- Группировка фильтров по секциям
- Toggle-переключатели для удобства
- Кнопка сброса всех фильтров

### 3. ActiveFiltersBar
**Файл**: `Views/CourseFilterView.swift`

- Горизонтальный scrollable бар с активными фильтрами
- Показывает количество активных фильтров
- Отображает chips для каждого активного фильтра

### 4. Интеграция в CourseManagementView
**Файл**: `Views/CourseManagementView.swift`

- Кнопка фильтров в toolbar (меняет цвет при активных фильтрах)
- Применение фильтров к списку курсов
- Сочетание фильтрации с поиском

## Функциональность

### Типы фильтров:
1. **По статусу**: Черновик, Опубликован, В архиве
2. **По типу**: Cmi5 курсы, Обычные курсы
3. **По модулям**: С модулями, Без модулей
4. **По компетенциям**: С компетенциями, Без компетенций

### Особенности:
- Взаимоисключающие фильтры (например, Cmi5 vs Обычные)
- Комбинирование нескольких фильтров
- Сохранение состояния между сессиями
- Визуальная индикация активных фильтров

## TDD процесс

### Написано тестов: 20
- 15 тестов для фильтрации
- 3 теста для состояния
- 2 теста для персистентности

### TDD compliance: 100%
- Все тесты написаны первыми
- Реализован минимальный код для прохождения
- Рефакторинг UI после прохождения тестов

## Архитектурные решения

### 1. Отдельный ViewModel для фильтров
- Изоляция логики фильтрации
- Возможность переиспользования
- Упрощение тестирования

### 2. Персистентность через UserDefaults
- Кодирование состояния в JSON
- Автоматическое восстановление при запуске
- Флаг hasState для проверки наличия сохраненного состояния

### 3. Реактивность через @Published
- Автоматическое обновление UI
- Computed property filteredCourses
- Эффективная фильтрация

## Интеграция

### С существующими компонентами:
- CourseManagementView - основной экран
- ManagedCourse - модель курса
- CourseService - источник данных

### Новые зависимости:
- Нет внешних зависимостей
- Использует только SwiftUI и Foundation

## Производительность

- Фильтрация выполняется в computed property
- O(n) сложность для каждого фильтра
- Ленивое вычисление при изменении фильтров
- Оптимизация для больших списков не требуется (< 1000 курсов)

## Дальнейшие улучшения

1. **Сохранение пресетов фильтров**
2. **Экспорт отфильтрованного списка**
3. **Дополнительные фильтры** (по дате, автору)
4. **Сортировка** в дополнение к фильтрации
5. **Batch операции** над отфильтрованными курсами

## Скриншоты UI

### Кнопка фильтров
- Обычное состояние: `line.3.horizontal.decrease.circle`
- С активными фильтрами: `line.3.horizontal.decrease.circle.fill` (синий)

### Экран фильтров
- Form с 4 секциями
- Toggle переключатели с иконками
- Кнопки "Отмена" и "Применить"

### Активные фильтры
- Горизонтальный бар под навигацией
- Chips с названиями фильтров и цветами

---

**Sprint 47, День 151**  
**Статус**: ✅ Завершено  
**BUILD SUCCEEDED** 