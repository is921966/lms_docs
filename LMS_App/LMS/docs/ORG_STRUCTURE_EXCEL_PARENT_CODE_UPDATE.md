# Обновление импорта оргструктуры: Поддержка явной иерархии через "Вышестоящий Код"

## Дата обновления
14 июля 2025

## Проблема решена
- Автоматическое определение иерархии по коду (АП.1.2 → родитель АП.1) удалено
- Добавлена обязательная колонка "Вышестоящий Код" для явного указания иерархии

## Новый формат Excel

### Обязательные колонки:
1. **Код** - уникальный код подразделения (например: АП, АП.1, АП.1.1)
2. **Вышестоящий Код** - код родительского подразделения
   - Для корневых подразделений - оставить пустым
   - Для остальных - указать код родителя
3. **Название подразделения** - название подразделения
4. **Табельный номер** - табельный номер сотрудника (формат: АР + 8 цифр)
5. **ФИО** - полное имя сотрудника
6. **Должность** - должность сотрудника

### Опциональные колонки:
7. **Email** - электронная почта сотрудника
8. **Телефон** - телефон сотрудника

## Пример структуры данных

| Код | Вышестоящий Код | Название подразделения | Табельный номер | ФИО | Должность | Email | Телефон |
|-----|-----------------|------------------------|-----------------|-----|-----------|-------|---------|
| АП | | ЦУМ | АР00000001 | Иванов И.И. | Генеральный директор | ivanov@tsum.ru | +7(495)123-45-67 |
| АП.1 | АП | Департамент продаж | АР00000002 | Петров П.П. | Директор департамента | petrov@tsum.ru | +7(495)123-45-68 |
| АП.1.1 | АП.1 | Отдел розничных продаж | АР00000003 | Сидоров С.С. | Начальник отдела | sidorov@tsum.ru | +7(495)123-45-69 |

## Важные изменения

### 1. Обновлена инструкция в интерфейсе
- Добавлена информация о колонке "Вышестоящий Код"
- Колонка выделена синим цветом для привлечения внимания
- Указано, что колонки Email и Телефон опциональны

### 2. Обновлен шаблон Excel
- Добавлена колонка "Вышестоящий Код" между "Код" и "Название подразделения"
- В примерах показана правильная иерархия:
  - АП (пустой вышестоящий код - это корень)
  - АП.1 (вышестоящий код: АП)
  - АП.1.1 (вышестоящий код: АП.1)

### 3. Обновлен парсер Excel
- Парсер теперь ищет колонку "Вышестоящий Код"
- Иерархия строится на основе явно указанных связей
- Удалена логика автоматического определения родителя по формату кода

## Преимущества нового подхода

1. **Гибкость** - можно использовать любые коды, не привязываясь к формату
2. **Надежность** - нет ошибок из-за неправильного формата кодов
3. **Прозрачность** - иерархия явно видна в данных
4. **Простота** - легко изменить структуру, просто поменяв вышестоящий код

## Миграция существующих данных

Если у вас есть Excel файлы в старом формате:
1. Добавьте колонку "Вышестоящий Код" после колонки "Код"
2. Для каждого подразделения укажите код его родителя
3. Для корневых подразделений оставьте ячейку пустой

## Тестирование

Функция скачивания шаблона работает корректно:
- При нажатии кнопки "Скачать шаблон" открывается системный диалог
- Можно сохранить файл или отправить его через AirDrop
- Шаблон содержит правильную структуру с примерами данных 