# Интеграция Cmi5 с системой управления курсами

## Обзор
Реализована полная интеграция импортированных Cmi5 пакетов с системой управления курсами. Теперь при импорте Cmi5 пакета автоматически создается соответствующий курс, который появляется в общем списке курсов и может быть назначен студентам.

## Архитектура интеграции

### 1. Автоматическое создание курса при импорте

При импорте Cmi5 пакета выполняется следующая последовательность действий:

```
1. Импорт Cmi5 пакета
   ↓
2. Сохранение в Cmi5Repository
   ↓
3. Конвертация в ManagedCourse (Cmi5CourseConverter)
   ↓
4. Создание курса через CourseService
   ↓
5. Обновление Cmi5Package с ID созданного курса
   ↓
6. Курс доступен в системе управления
```

### 2. Компоненты интеграции

#### Cmi5CourseConverter
**Файл:** `LMS/Features/Cmi5/Services/Cmi5CourseConverter.swift`

Конвертирует Cmi5Package в ManagedCourse:
- Извлекает структуру модулей из блоков Cmi5
- Рассчитывает продолжительность курса
- Устанавливает статус "Опубликован" для импортированных курсов
- Сохраняет связь с исходным Cmi5 пакетом

#### Обновленная модель ManagedCourse
**Файл:** `LMS/Features/CourseManagement/Models/ManagedCourse.swift`

Добавлено поле `cmi5PackageId: UUID?` для отслеживания курсов, созданных из Cmi5 пакетов.

#### Обновленный Cmi5Service
**Файл:** `LMS/Features/Cmi5/Services/Cmi5Service.swift`

Метод `importPackage` теперь:
1. Импортирует Cmi5 пакет
2. Создает ManagedCourse через конвертер
3. Сохраняет курс в системе управления
4. Обновляет пакет с ID созданного курса

### 3. Визуальная интеграция

#### CourseManagementView
**Файл:** `LMS/Features/CourseManagement/Views/CourseManagementView.swift`

Курсы, созданные из Cmi5 пакетов, отображаются с:
- Индикатором "Cmi5" рядом с названием
- Количеством модулей в описании
- Синим цветом для выделения

## Использование

### Импорт Cmi5 курса и его появление в системе:

1. **Импорт через Cmi5 Management**
   - Перейдите в раздел "Управление Cmi5"
   - Нажмите "Импортировать пакет"
   - Выберите ZIP архив или используйте демо-курс
   - После успешного импорта курс автоматически появится в "Управлении курсами"

2. **Назначение студентам**
   - Перейдите в "Управление курсами"
   - Найдите курс с индикатором "Cmi5"
   - Используйте стандартные функции назначения

3. **Управление курсом**
   - Курсы из Cmi5 можно редактировать, архивировать и удалять как обычные курсы
   - Связь с Cmi5 пакетом сохраняется для отслеживания происхождения

## Примеры интеграции

### Структура конвертированного курса:
```swift
ManagedCourse(
    title: "Демонстрационный курс",
    description: "Курс импортирован из Cmi5 пакета",
    duration: 2, // часы (рассчитано из количества активностей)
    status: .published,
    modules: [
        ManagedCourseModule(
            title: "Основные модули",
            contentType: .cmi5,
            duration: 30 // минуты на активность
        )
    ],
    cmi5PackageId: UUID(...) // связь с пакетом
)
```

### Отображение в списке курсов:
- ✅ Название курса из Cmi5 манифеста
- ✅ Индикатор "Cmi5" для идентификации
- ✅ Количество модулей
- ✅ Статус "Опубликован"

## Технические детали

### Обработка ошибок
Если создание курса в системе управления не удается:
- Cmi5 пакет все равно импортируется
- Добавляется предупреждение в результат импорта
- Администратор может создать курс вручную позже

### Синхронизация данных
- ID курса сохраняется в Cmi5Package для двусторонней связи
- При удалении курса Cmi5 пакет остается в системе
- При удалении Cmi5 пакета курс может быть оставлен или удален

## Будущие улучшения

1. **Автоматическое создание уроков**
   - Конвертация Cmi5 активностей в отдельные уроки
   - Сохранение URL для запуска активностей

2. **Синхронизация прогресса**
   - Интеграция с xAPI для отслеживания прохождения
   - Автоматическое обновление статистики

3. **Массовый импорт**
   - Импорт нескольких Cmi5 пакетов одновременно
   - Batch создание курсов

## Статус
✅ **Интеграция завершена**
- Cmi5 пакеты автоматически создают курсы
- Курсы отображаются в системе управления
- Можно назначать курсы студентам
- Визуальная индикация Cmi5 курсов 