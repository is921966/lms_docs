# Каталог требований (v2.2.0)

Дата: 2025-07-25
Актуально для: LMS «ЦУМ: Корпоративный университет»
Связанные документы: SYSTEM_TECHNICAL_SPEC_v2.2.0.md, TDD_MANDATORY_GUIDE.md, .cursor/rules/productmanager.mdc

## 1. Функциональные требования (FR)

### 1.1. Аутентификация и профили
- FR-Auth-01: Пользователь может войти по корпоративной учетной записи (MVP — Mock Auth, план — MS AD).
- FR-Auth-02: Профиль содержит: ФИО, роль, подразделение, должность, аватар.
- FR-Auth-03: Публичные разделы доступны без авторизации (лента — только чтение).
- FR-Auth-04: Роли: admin, moderator, student, employee, instructor, staff.
- FR-Auth-05: Пользователь может редактировать свой профиль; админ — любой.

### 1.2. Лента (Feed) — Telegram‑стиль
- FR-Feed-01: Просмотр списка постов с пагинацией/ленивой подгрузкой.
- FR-Feed-02: Карточка поста: аватар канала, название канала, заголовок, короткий текст, превью медиа, счетчики.
- FR-Feed-03: Детальная страница поста с полным содержимым и медиа.
- FR-Feed-04: Поиск/фильтры: по каналу, по тексту, по тегам (после добавления тегов).
- FR-Feed-05: Реакции (лайки/эмодзи) — визуальные, с последующей серверной реализацией.
- FR-Feed-06: Создание поста: заголовок, контент, выбор канала; предпросмотр; публикация.
- FR-Feed-07: Каналы: создание/редактирование для ролей admin/moderator.
- FR-Feed-08: Счетчики: постов в канале, реакций, комментариев.
- FR-Feed-09: Комментарии к постам (после базового запуска).
- FR-Feed-10: Realtime‑обновления ленты (после стабилизации RLS/индексов).

### 1.3. Курсы и обучение (минимальный MVP)
- FR-Courses-01: Просмотр списка курсов с фильтрами.
- FR-Courses-02: Карточка курса: название, описание, длительность, статус (не записан/в процессе).
- FR-Courses-03: Запись на курс (mock), переход к продолжению.
- FR-Courses-04: Поиск по названию/тегам (позже — компетенции).
- FR-Courses-05: Просмотр деталей курса и контента (WebView/плеер позже).

### 1.4. Интеграция iOS
- FR-iOS-01: Открытие веб‑модулей (лента, курсы) в WebView.
- FR-iOS-02: Deep Link маршруты: lms://feed, lms://course/<id>.
- FR-iOS-03: Feature Registry регистрация модуля и доступность через меню.
- FR-iOS-04: Логирование действий пользователя (ui, navigation, error, data, network).

### 1.5. Администрирование (минимум)
- FR-Admin-01: Создание/редактирование каналов ленты.
- FR-Admin-02: Просмотр ошибок и статусов (через логи/health API).
- FR-Admin-03: Ручной запуск seed/миграций (через SQL Editor/скрипты).

### 1.6. Отчеты и мониторинг
- FR-Report-01: Health API: /api/health
- FR-Report-02: Check‑DB API: /api/check-db (статусы таблиц)
- FR-Report-03: Sentry интеграция для ошибок (клиент/сервер)

### 1.7. Оргструктура и позиции сотрудников
- FR-Org-01: Иерархическое дерево подразделений с уровнями вложенности ≥ 5, счётчиками сотрудников и хлебными крошками.
- FR-Org-02: CRUD подразделений: создание, редактирование, удаление с проверкой дочерних, перемещение в другую ветвь.
- FR-Org-03: Атрибуты подразделения: полное название, код (АП.X.X.X), руководитель, количество сотрудников, дочерние узлы.
- FR-Org-04: Поиск по подразделениям/сотрудникам (ФИО, табельный номер, должность), автодополнение с 3 символов.
- FR-Org-05: Импорт из Excel: drag&drop, предпросмотр, маппинг колонок, распознавание кодов АП.* и табельных номеров.
- FR-Org-06: Протокол ошибок импорта и отчёт по результатам (успешно/ошибки/пропуски).
- FR-Org-07: Интеграция: связь сотрудников оргструктуры с профилями пользователей, синхронизация ФИО/email.
- FR-Org-08: Разграничение прав: создание/редактирование доступно ролям admin/moderator; просмотр — всем авторизованным.

- FR-Pos-01: Справочник должностей (позиции): CRUD, версия полей и актуальность.
- FR-Pos-02: Атрибуты позиции: код, наименование, грейд/бэнд, категория (руководитель/специалист), подразделение, матрица компетенций, обязательные тренинги, обязанности, дата вступления в силу.
- FR-Pos-03: Связи: позиция ↔ компетенции, позиция ↔ курсы (обязательные/рекомендуемые), позиция ↔ сотрудники.
- FR-Pos-04: Валидации: уникальность кода позиции, соответствие подразделениям и грейдам.
- FR-Pos-05: Отчёты: список позиций с фильтрами (подразделение, грейд, категория), экспорт результатов.
- FR-Pos-06: Импорт/обновление позиций из Excel с маппингом и детализированным логом.

См. также: `technical_requirements/org_structure_module_tech_spec.md` — детальная спецификация модуля оргструктуры.

## 2. Нефункциональные требования (NFR)

### 2.1. Производительность
- NFR-Perf-01: Время TTFB страниц ≤ 500 мс (прод), P95 ≤ 1.5 с.
- NFR-Perf-02: Отрисовка ленты: первые карточки видимы ≤ 1.2 с на холодном старте.
- NFR-Perf-03: Индексация БД для основных запросов (канал, дата публикации).

### 2.2. Надежность и доступность
- NFR-Rel-01: Health‑эндпоинты доступны 99.9% времени.
- NFR-Rel-02: Бэкапы БД (Supabase/Managed), точка восстановления ≤ 24 часа.

### 2.3. Безопасность
- NFR-Sec-01: Все таблицы под RLS; запись — только аутентифицированным.
- NFR-Sec-02: Секреты хранить в GitHub/Railway Secrets, не в коде.
- NFR-Sec-03: CORS ограничить доменами деплоя (прод).

### 2.4. Масштабируемость
- NFR-Sca-01: Горизонтальное масштабирование веб‑сервиса (Railway реплики ≥ 2 при пике).
- NFR-Sca-02: Использование CDN для статики (Vercel/Edge опционально).

### 2.5. Поддерживаемость
- NFR-Mnt-01: Код по гайдлайнам (.cursorrules), файлы ≤ 150 строк где возможно.
- NFR-Mnt-02: Покрытие тестами ключевых компонентов ≥ 90% (реалистичный минимум — 80% на MVP модулях с обязательным ростом).

## 3. Требования к процессам (PR)

### 3.1. Методология и TDD
- PR-TDD-01: Тест пишется первым (RED), затем минимальный код (GREEN), затем рефакторинг (REFACTOR), затем логирование (LOG).
- PR-TDD-02: Каждый тест выполняется в течение 5 минут после написания.
- PR-TDD-03: Запрещено иметь красные тесты; pre-commit hook блокирует коммит.
- PR-TDD-04: Максимум 10 новых тестов в день; качество важнее количества.
- PR-TDD-05: Тесты проверяют логи важных действий.

### 3.2. Вертикальный срез и Feature Registry
- PR-VS-01: Каждый модуль полностью интегрирован: UI → API → БД.
- PR-VS-02: Модуль регистрируется в Feature Registry (iOS), добавляются интеграционные тесты доступности.

### 3.3. Контроль времени и отчётность
- PR-Time-01: В начале дня обязательно создать запись в БД учёта времени (`scripts/project_time_db.py start <день>` или `./scripts/report.sh start-day`).
- PR-Time-02: После старта — вывести последние 10 записей для контроля.
- PR-Time-03: В конце дня — завершить запись (`end <день>`). Без записи день «не существует».

### 3.4. CI/CD и компиляция
- PR-CICD-01: Локальная сборка/тесты обязательны до push.
- PR-CICD-02: GitHub Actions: job test (npm ci → тесты → build), затем deploy (Railway).
- PR-CICD-03: На iOS обязательна проверка компиляции через xcodebuild перед любым push.

### 3.5. Документация
- PR-Doc-01: Вся рабочая документация — на русском, строгое расположение файлов в `/reports/...`.
- PR-Doc-02: Обновлять методологию при выявлении новых правил; синхронизация через `./sync-methodology.sh`.
- PR-Doc-03: Обязательные ежедневные отчеты и спринтовые документы согласно структуре проекта.

### 3.6. Логирование и наблюдаемость
- PR-Log-01: В iOS использовать ComprehensiveLogger (категории: ui, network, data, navigation, error).
- PR-Log-02: Тесты проверяют наличие соответствующих логов при ключевых действиях.
- PR-Log-03: Веб‑клиент: логирование ошибок в Sentry; Health/Check‑DB endpoints обязательны.

## 4. Критерии приемки (сводно)

- AC-Feed-01: После выполнения seed данные видны по `/feed` (≥ 3 поста), без ошибок консоли.
- AC-Feed-02: Создание поста из `PostEditor` добавляет запись в `feed_posts` (dev окружение), UI обновляется.
- AC-Perf-01: P95 TTFB ≤ 1.5 с, видимость первых карточек ≤ 1.2 с.
- AC-TDD-01: Все тесты зелёные локально и в CI, pre-commit включён.
- AC-RLS-01: Публичное чтение ленты работает, запись доступна только аутентифицированным.

## 5. Трассировка требований → артефакты

- FR-Feed-* → `src/app/(dashboard)/feed/page.tsx`, `PostCard.tsx`, `useFeed.ts`.
- FR-Courses-* → `src/app/(dashboard)/courses/page.tsx`, `CourseCard.tsx`.
- PR-CICD-* → `.github/workflows/deploy.yml`, `railway.toml`.
- NFR‑Sec-* → RLS политики в Supabase и секреты в GitHub/Railway.

---

Каталог обновляется по мере эволюции системы и должен рассматриваться как источник истины для планирования спринтов и приемки результатов.
