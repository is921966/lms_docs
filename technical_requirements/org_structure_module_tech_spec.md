# Техническое задание: Модуль "Оргструктура компании"

## 1. Общее описание

### 1.1 Цель модуля
Предоставить инструмент для управления и визуализации организационной структуры компании с возможностью импорта данных из Excel файлов.

### 1.2 Ключевые возможности
- Иерархическое отображение структуры подразделений
- Управление сотрудниками и их привязка к подразделениям
- Импорт данных из Excel с интеллектуальным парсингом
- Поиск и навигация по структуре
- Интеграция с существующими модулями системы

## 2. Функциональные требования

### 2.1 Управление подразделениями

#### 2.1.1 Просмотр структуры
- **Дерево подразделений** с возможностью сворачивания/разворачивания узлов
- **Визуальная иерархия** с отступами и линиями связи
- **Индикаторы** количества сотрудников в каждом подразделении
- **Уровни вложенности**: поддержка минимум 5 уровней иерархии

#### 2.1.2 CRUD операции
- **Создание** нового подразделения с указанием родительского
- **Редактирование** названия и кода подразделения
- **Удаление** подразделения (с проверкой на наличие дочерних и сотрудников)
- **Перемещение** подразделения в другую ветку иерархии

#### 2.1.3 Детальная информация
- Полное название подразделения
- Уникальный код (формат АП.X.X.X.X)
- Руководитель подразделения
- Количество сотрудников
- Дочерние подразделения

### 2.2 Управление сотрудниками

#### 2.2.1 Карточка сотрудника
- **Табельный номер** (формат АР + 8 цифр)
- **ФИО** полностью
- **Должность** из справочника должностей
- **Подразделение** с полным путем в иерархии
- **Контакты**: email, рабочий телефон
- **Фото** (опционально, с заглушкой по умолчанию)

#### 2.2.2 Списки сотрудников
- Группировка по подразделениям
- Сортировка по ФИО, должности, табельному номеру
- Фильтрация по подразделению, должности
- Постраничная навигация (50 записей на страницу)

### 2.3 Импорт из Excel

#### 2.3.1 Загрузка файла
- **Drag & Drop** интерфейс для загрузки
- Поддержка форматов: .xlsx, .xls
- Максимальный размер файла: 10 МБ
- Валидация формата перед обработкой

#### 2.3.2 Парсинг данных
- **Автоматическое определение** типа строки (подразделение/сотрудник)
- **Распознавание паттернов**:
  - Табельный номер: АР + цифры
  - Код подразделения: АП.X.X.X
- **Построение иерархии** по кодам подразделений
- **Обработка дубликатов** с выбором действия

#### 2.3.3 Предпросмотр и маппинг
- Отображение первых 50 записей для проверки
- Возможность указать соответствие колонок
- Подсветка распознанных данных
- Статистика: количество подразделений, сотрудников, ошибок

#### 2.3.4 Процесс импорта
- **Progress bar** с процентом выполнения
- **Лог операций** в реальном времени
- **Обработка ошибок** с детальным описанием
- **Отчет об импорте**: успешно/с ошибками/пропущено

### 2.4 Поиск и навигация

#### 2.4.1 Быстрый поиск
- Поиск по имени сотрудника
- Поиск по табельному номеру
- Поиск по названию подразделения
- Автодополнение при вводе (после 3 символов)

#### 2.4.2 Расширенный поиск
- Комбинированные фильтры
- Поиск по должности
- Поиск по уровню в иерархии
- Экспорт результатов поиска

#### 2.4.3 Навигация
- **Хлебные крошки** для отображения пути в иерархии
- **Кнопка "Вверх"** для перехода к родительскому подразделению
- **История навигации** с возможностью возврата
- **Избранные** подразделения для быстрого доступа

## 3. Нефункциональные требования

### 3.1 Производительность
- Загрузка дерева структуры: < 2 секунды для 1000 подразделений
- Поиск: < 100 мс для базы 10000 сотрудников
- Импорт: < 10 секунд для файла с 1000 записей
- Плавная анимация сворачивания/разворачивания узлов

### 3.2 Масштабируемость
- Поддержка до 10000 подразделений
- Поддержка до 50000 сотрудников
- Горизонтальное масштабирование backend

### 3.3 Безопасность
- Разграничение прав доступа по ролям
- Логирование всех изменений структуры
- Защита от SQL-инъекций при импорте
- Валидация всех входных данных

### 3.4 Совместимость
- iOS 15.0+
- Поддержка iPhone и iPad
- Адаптивный интерфейс для разных размеров экранов
- Поддержка темной темы

## 4. Интеграции

### 4.1 С модулем пользователей
- Связь сотрудника оргструктуры с учетной записью пользователя
- Синхронизация данных (ФИО, email)
- Автоматическое создание пользователя при импорте

### 4.2 С модулем должностей
- Выбор должности из существующего справочника
- Создание новых должностей при импорте
- Валидация соответствия должности и подразделения

### 4.3 С системой уведомлений
- Уведомления о изменениях в структуре
- Уведомления о завершении импорта
- Уведомления об ошибках

## 5. UI/UX требования

### 5.1 Дизайн
- Соответствие iOS Human Interface Guidelines
- Единый стиль с остальными модулями приложения
- Использование системных иконок SF Symbols
- Цветовая дифференциация уровней иерархии

### 5.2 Удобство использования
- Минимум кликов для частых операций
- Контекстные меню для быстрых действий
- Swipe-действия в списках
- Поддержка жестов (pinch to zoom для дерева)

### 5.3 Адаптивность
- Корректное отображение на всех устройствах
- Ландшафтная ориентация для iPad
- Оптимизация для работы одной рукой на iPhone

## 6. Тестовые сценарии

### 6.1 Импорт данных
1. Загрузить файл ДИТ.xlsx
2. Проверить корректность распознавания 69 подразделений
3. Проверить корректность распознавания 303 сотрудников
4. Убедиться в правильности построения иерархии

### 6.2 Навигация
1. Развернуть все уровни дерева
2. Найти сотрудника "Клейменов Евгений Борисович"
3. Перейти к его подразделению
4. Вернуться к корню структуры

### 6.3 Производительность
1. Импортировать файл с 5000+ записей
2. Выполнить поиск по частичному совпадению
3. Проверить скорость отрисовки дерева

## 7. Критерии приемки

1. ✅ Все функциональные требования реализованы
2. ✅ Покрытие тестами > 90%
3. ✅ Производительность соответствует требованиям
4. ✅ UI соответствует макетам и guidelines
5. ✅ Успешный импорт тестового файла
6. ✅ Отсутствие критических багов
7. ✅ Документация обновлена

## 8. Риски и ограничения

### 8.1 Технические риски
- **Риск**: Различные форматы Excel файлов
  - **Митигация**: Гибкий маппинг колонок, подробная документация формата

- **Риск**: Большой объем данных влияет на производительность
  - **Митигация**: Пагинация, lazy loading, кеширование

### 8.2 Бизнес-риски
- **Риск**: Изменение структуры организации во время разработки
  - **Митигация**: Гибкая модель данных, версионирование структуры

### 8.3 Ограничения
- Первая версия поддерживает только один формат кодировки (АП.X.X.X)
- Отсутствует история изменений структуры
- Нет автоматической синхронизации с внешними HR системами

## 9. Будущие улучшения

1. **Версия 2.0**:
   - История изменений структуры
   - Экспорт структуры в различные форматы
   - Визуализация в виде организационной диаграммы

2. **Версия 3.0**:
   - Интеграция с Active Directory
   - Автоматическая синхронизация с 1С
   - Аналитика и отчеты по структуре

## 10. Глоссарий

- **Подразделение** - структурная единица организации
- **Табельный номер** - уникальный идентификатор сотрудника
- **Код подразделения** - уникальный иерархический код (АП.X.X.X)
- **Уровень иерархии** - глубина вложенности подразделения 