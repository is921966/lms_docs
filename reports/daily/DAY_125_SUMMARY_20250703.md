# –î–µ–Ω—å 125 (–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –¥–µ–Ω—å 13) - Sprint 26, –î–µ–Ω—å 2/5

**–î–∞—Ç–∞**: 3 –∏—é–ª—è 2025  
**–û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞**: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ API Gateway

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ API Gateway - Domain Layer
- –°–æ–∑–¥–∞–Ω JwtServiceInterface –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- –°–æ–∑–¥–∞–Ω RateLimiterInterface –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã value objects:
  - JwtToken (—Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º —Ç–µ—Å—Ç–∞–º–∏)
  - RateLimitKey (–¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
  - RateLimitResult (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤)
- –°–æ–∑–¥–∞–Ω InvalidTokenException –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤

### 2. ‚úÖ API Gateway - Application Layer
- AuthenticationMiddleware - –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
- RateLimitMiddleware - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π rate limiting:
  - –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –ü–æ IP –∞–¥—Ä–µ—Å—É
  - –°–º–µ—à–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
  - –ì–ª–æ–±–∞–ª—å–Ω–∞—è

### 3. ‚úÖ API Gateway - Infrastructure Layer
- InMemoryRateLimiter - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è rate limiter –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### 4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
  - JwtTokenTest (9 —Ç–µ—Å—Ç–æ–≤)
  - RateLimitKeyTest (6 —Ç–µ—Å—Ç–æ–≤)
  - RateLimitResultTest (10 —Ç–µ—Å—Ç–æ–≤)
  - InMemoryRateLimiterTest (7 —Ç–µ—Å—Ç–æ–≤)
- **–í—Å–µ–≥–æ: 32 —Ç–µ—Å—Ç–∞, –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç!**

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Middleware Pipeline
```
Request ‚Üí AuthenticationMiddleware ‚Üí RateLimitMiddleware ‚Üí Service Router ‚Üí Response
             ‚Üì                           ‚Üì
         JWT Validation             Rate Limiting
             ‚Üì                           ‚Üì
         User Context               429 if exceeded
```

### Rate Limiting Strategy
- Token bucket –∞–ª–≥–æ—Ä–∏—Ç–º
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã –∏ –æ–∫–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π (user, IP, API key)
- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö

## ‚è±Ô∏è –ó–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è
- **–°–æ–∑–¥–∞–Ω–∏–µ Domain layer**: ~20 –º–∏–Ω—É—Ç
- **–°–æ–∑–¥–∞–Ω–∏–µ Application layer**: ~25 –º–∏–Ω—É—Ç
- **–°–æ–∑–¥–∞–Ω–∏–µ Infrastructure layer**: ~15 –º–∏–Ω—É—Ç
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**: ~30 –º–∏–Ω—É—Ç
- **–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: ~90 –º–∏–Ω—É—Ç

## üìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–°–∫–æ—Ä–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**: ~3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞/—á–∞—Å
- **–°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤**: ~20 —Ç–µ—Å—Ç–æ–≤/—á–∞—Å
- **–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–¥/—Ç–µ—Å—Ç—ã**: 1:1.2
- **–ö–∞—á–µ—Å—Ç–≤–æ**: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞

## üéØ –ü–ª–∞–Ω –Ω–∞ –æ—Å—Ç–∞—Ç–æ–∫ —Å–ø—Ä–∏–Ω—Ç–∞

### –î–µ–Ω—å 3 (–î–µ–Ω—å 126):
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å Competency —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**
2. **Service Router –¥–ª—è API Gateway**
3. **JWT Service —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**

### –î–µ–Ω—å 4 (–î–µ–Ω—å 127):
1. **Integration —Ç–µ—Å—Ç—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏**
2. **API Gateway controller**
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ DI**

### –î–µ–Ω—å 5 (–î–µ–Ω—å 128):
1. **E2E —Ç–µ—Å—Ç—ã**
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**
3. **Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

## üìä –°—Ç–∞—Ç—É—Å Sprint 26
- **–ó–∞–≤–µ—Ä—à–µ–Ω–æ**: 40% (2 –∏–∑ 5 –¥–Ω–µ–π)
- **API Gateway**: 60% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- **Competency —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**: –æ—Ç–ª–æ–∂–µ–Ω –Ω–∞ –¥–µ–Ω—å 3
- **Integration —Ç–µ—Å—Ç—ã**: –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –¥–µ–Ω—å 4

## üöß –ë–ª–æ–∫–µ—Ä—ã –∏ —Ä–∏—Å–∫–∏
- Competency –º–æ–¥—É–ª—å –≤—Å–µ –µ—â–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å–∫–æ—Ä–∏—Ç—å —Ç–µ–º–ø –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π —Å–ø—Ä–∏–Ω—Ç–∞

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –°–æ–∑–¥–∞—Ç—å Service Router –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å JWT Service —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º firebase/php-jwt
3. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ Competency —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
4. –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ integration —Ç–µ—Å—Ç–∞–º–∏

---

*–î–µ–Ω—å 125 –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π. API Gateway —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–æ, —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ—á–Ω–∞—è –æ—Å–Ω–æ–≤–∞ —Å –ø–æ–ª–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º. –ó–∞–≤—Ç—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å Competency –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å API Gateway.* 