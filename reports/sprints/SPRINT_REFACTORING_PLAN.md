# Sprint: Рефакторинг больших файлов

## Цель
Разбить файлы > 500 строк для оптимальной работы LLM, сохранив 100% тестовое покрытие.

## Приоритеты

### 1. User.php (677 строк) → 5 файлов
- `User.php` - основная модель (~200 строк)
- `Traits/UserAuthenticationTrait.php` - аутентификация (~150 строк)
- `Traits/UserRoleManagementTrait.php` - управление ролями (~100 строк)
- `Traits/UserProfileTrait.php` - профиль (~100 строк)
- `Traits/UserMetadataTrait.php` - метаданные (~100 строк)

### 2. AuthService.php (584 строки) → 4 сервиса
- `AuthService.php` - основная аутентификация (~200 строк)
- `TokenService.php` - JWT токены (~150 строк)
- `TwoFactorAuthService.php` - 2FA (~100 строк)
- `PasswordResetService.php` - сброс паролей (~100 строк)

### 3. LdapService.php (654 строки) → 4 сервиса
- `LdapAuthenticator.php` - аутентификация (~150 строк)
- `LdapUserImporter.php` - импорт пользователей (~200 строк)
- `LdapSynchronizer.php` - синхронизация (~150 строк)
- `LdapConfiguration.php` - конфигурация (~100 строк)

## План работы

### Шаг 1: User.php рефакторинг
1. Создать трейты для группировки функциональности
2. Перенести методы в соответствующие трейты
3. Обновить тесты UserTest.php
4. Запустить все тесты - должны проходить 100%

### Шаг 2: AuthService.php рефакторинг
1. Создать TokenService для JWT операций
2. Создать TwoFactorAuthService для 2FA
3. Создать PasswordResetService
4. Обновить AuthServiceTest.php
5. Запустить все тесты - должны проходить 100%

### Шаг 3: LdapService.php рефакторинг
1. Разделить на специализированные сервисы
2. Создать интерфейсы для каждого сервиса
3. Обновить тесты
4. Запустить все тесты - должны проходить 100%

## Правила рефакторинга
- ✅ Каждый коммит должен сохранять 100% тестов
- ✅ Использовать TDD: сначала тест, потом рефакторинг
- ✅ Целевой размер: 50-200 строк на файл
- ✅ Следовать Single Responsibility Principle

## Ожидаемый результат
- Все файлы < 300 строк
- 100% тестовое покрытие сохранено
- Улучшенная читаемость и поддерживаемость
- Оптимизация для работы с LLM 