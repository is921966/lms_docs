# Sprint 25 Plan - Notification Service
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 3 –∏—é–ª—è 2025 (–î–µ–Ω—å 119)  
**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 5 –¥–Ω–µ–π  
**–¶–µ–ª—å**: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π email, push –∏ in-app –∫–∞–Ω–∞–ª–æ–≤

## üéØ –¶–µ–ª–∏ —Å–ø—Ä–∏–Ω—Ç–∞

1. **Domain Layer** - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ value objects –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
2. **Application Layer** - use cases –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
3. **Infrastructure Layer** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ email –∏ push
4. **HTTP Layer** - REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ unit –∏ integration —Ç–µ—Å—Ç–∞–º–∏

## üìã User Stories

### Story 1: –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–ö–∞–∫** –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã  
**–Ø —Ö–æ—á—É** –∏–º–µ—Ç—å –≥–∏–±–∫—É—é –º–æ–¥–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π  
**–ß—Ç–æ–±—ã** –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**Acceptance Criteria**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–Ω–∞–ª–æ–≤: email, push, in-app
- –®–∞–±–ª–æ–Ω—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏

### Story 2: –û—Ç–ø—Ä–∞–≤–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–ö–∞–∫** —Å–∏—Å—Ç–µ–º–∞  
**–Ø —Ö–æ—á—É** –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
**–ß—Ç–æ–±—ã** –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö

**Acceptance Criteria**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SMTP —Å–µ—Ä–≤–µ—Ä–æ–º
- HTML –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã
- –í–ª–æ–∂–µ–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏

### Story 3: Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–Ø —Ö–æ—á—É** –ø–æ–ª—É—á–∞—Ç—å push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
**–ß—Ç–æ–±—ã** –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**Acceptance Criteria**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å APNs (iOS)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

### Story 4: In-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–Ø —Ö–æ—á—É** –≤–∏–¥–µ—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ß—Ç–æ–±—ã** –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

**Acceptance Criteria**:
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
- –°—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

### Story 5: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–Ø —Ö–æ—á—É** —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π  
**–ß—Ç–æ–±—ã** –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**Acceptance Criteria**:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å)
- –Ø–∑—ã–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Domain Layer
```
Notification/
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Notification.php              # –û—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ NotificationTemplate.php      # –®–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ NotificationPreference.php    # –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ ValueObjects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationId.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationType.php      # email, push, in-app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationChannel.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationPriority.php  # high, medium, low
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationStatus.php    # pending, sent, delivered, failed
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RecipientId.php
‚îÇ   ‚îú‚îÄ‚îÄ Events/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationCreated.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationSent.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationFailed.php
‚îÇ   ‚îî‚îÄ‚îÄ Repository/
‚îÇ       ‚îú‚îÄ‚îÄ NotificationRepositoryInterface.php
‚îÇ       ‚îî‚îÄ‚îÄ NotificationPreferenceRepositoryInterface.php
```

### Application Layer
```
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ UseCases/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SendNotificationUseCase.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SendBulkNotificationsUseCase.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MarkAsReadUseCase.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdatePreferencesUseCase.php
‚îÇ   ‚îú‚îÄ‚îÄ DTO/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationDTO.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationPreferenceDTO.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BulkNotificationDTO.php
‚îÇ   ‚îî‚îÄ‚îÄ Services/
‚îÇ       ‚îú‚îÄ‚îÄ NotificationDispatcher.php
‚îÇ       ‚îî‚îÄ‚îÄ TemplateRenderer.php
```

### Infrastructure Layer
```
‚îú‚îÄ‚îÄ Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ Persistence/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InMemoryNotificationRepository.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InMemoryPreferenceRepository.php
‚îÇ   ‚îú‚îÄ‚îÄ Email/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SmtpEmailProvider.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EmailNotificationSender.php
‚îÇ   ‚îú‚îÄ‚îÄ Push/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApnsPushProvider.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PushNotificationSender.php
‚îÇ   ‚îî‚îÄ‚îÄ Templates/
‚îÇ       ‚îî‚îÄ‚îÄ TwigTemplateRenderer.php
```

## üìÖ –ü–ª–∞–Ω –ø–æ –¥–Ω—è–º

### –î–µ–Ω—å 1 (119) - Domain Layer
- [ ] Value Objects (6 –∫–ª–∞—Å—Å–æ–≤)
- [ ] Notification entity
- [ ] NotificationTemplate entity
- [ ] Domain events
- [ ] Repository interfaces
- **–û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã**: 40-50

### –î–µ–Ω—å 2 (120) - Application Layer
- [ ] DTOs (3 –∫–ª–∞—Å—Å–∞)
- [ ] SendNotificationUseCase
- [ ] BulkNotification use case
- [ ] Template rendering service
- **–û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã**: 30-40

### –î–µ–Ω—å 3 (121) - Infrastructure Email
- [ ] In-memory repositories
- [ ] SMTP integration
- [ ] Email sender implementation
- [ ] Template renderer
- **–û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã**: 25-30

### –î–µ–Ω—å 4 (122) - Push & In-app
- [ ] Push notification sender
- [ ] APNs mock provider
- [ ] In-app storage
- [ ] Mark as read functionality
- **–û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã**: 20-25

### –î–µ–Ω—å 5 (123) - HTTP & Integration
- [ ] NotificationController
- [ ] REST API endpoints
- [ ] OpenAPI documentation
- [ ] Integration tests
- **–û–∂–∏–¥–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã**: 15-20

## üéØ Definition of Done

- [ ] –í—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ú–∏–Ω–∏–º—É–º 130 —Ç–µ—Å—Ç–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω–æ –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Test coverage > 95%
- [ ] REST API –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] README –¥–ª—è –º–æ–¥—É–ª—è —Å–æ–∑–¥–∞–Ω
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: 30+ —Ç–µ—Å—Ç–æ–≤/–¥–µ–Ω—å
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Clean Architecture —Å–æ–±–ª—é–¥–µ–Ω–∞
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: OpenAPI spec –≥–æ—Ç–æ–≤–∞

## üöÄ –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

1. **–†–∏—Å–∫**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å email/push –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
   **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è MVP

2. **–†–∏—Å–∫**: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–µ
   **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: Async –æ–±—Ä–∞–±–æ—Ç–∫–∞, –æ—á–µ—Ä–µ–¥–∏

3. **–†–∏—Å–∫**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å—Ç–∞—Ä—Ç—É**: ‚úÖ  
**–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: User –º–æ–¥—É–ª—å (–¥–ª—è RecipientId) 