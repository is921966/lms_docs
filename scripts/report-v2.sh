#!/bin/bash

# Report generation script v2.0 - —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π project-time.py
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
REPORTS_DIR="$PROJECT_ROOT/reports"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ project-time.py
get_time_data() {
    local command=$1
    python3 "$SCRIPT_DIR/project-time.py" $command
}

# –°–æ–∑–¥–∞–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
create_daily_report() {
    local filename=$(get_time_data "filename daily")
    local header=$(get_time_data "header")
    local filepath="$REPORTS_DIR/daily/$filename"
    
    if [ -f "$filepath" ]; then
        echo "‚ö†Ô∏è  –§–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $filename"
        echo "–•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/n)"
        read -r response
        if [[ "$response" != "y" ]]; then
            return 1
        fi
    fi
    
    cat > "$filepath" << EOF
$header
**–°–ø—Ä–∏–Ω—Ç**: $(get_time_data "sprint" | cut -d',' -f1) - [–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞]  
**–ê–≤—Ç–æ—Ä**: AI Development Team

## üéØ –¶–µ–ª–∏ –¥–Ω—è
1. [ ] –¶–µ–ª—å 1
2. [ ] –¶–µ–ª—å 2
3. [ ] –¶–µ–ª—å 3

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ó–∞–¥–∞—á–∞ 1 (–≤—Ä–µ–º—è)
- –î–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 2. –ó–∞–¥–∞—á–∞ 2 (–≤—Ä–µ–º—è)
- –î–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–Ω—è
- **–ù–∞–ø–∏—Å–∞–Ω–æ –∫–æ–¥–∞**: X —Å—Ç—Ä–æ–∫
- **–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤**: Y —Ç–µ—Å—Ç–æ–≤
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: Z%
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –±–∞–≥–æ–≤**: N

## ‚è±Ô∏è –ó–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- **–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: X —á–∞—Å–æ–≤
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞**: Y —á–∞—Å–æ–≤
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**: Z —á–∞—Å–æ–≤
- **–û—Ç–ª–∞–¥–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: W —á–∞—Å–æ–≤

## üí° –í—ã–≤–æ–¥—ã –∏ –∏–Ω—Å–∞–π—Ç—ã
- –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ
- –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
- –ë–ª–æ–∫–µ—Ä—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã

## üéØ –ü–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
1. –ó–∞–¥–∞—á–∞ 1
2. –ó–∞–¥–∞—á–∞ 2
3. –ó–∞–¥–∞—á–∞ 3

---

**–°—Ç–∞—Ç—É—Å**: –î–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω  
**–°–ª–µ–¥—É—é—â–∏–π –æ—Ç—á–µ—Ç**: –î–µ–Ω—å $(( $(get_time_data "conditional-day") + 1 ))
EOF

    echo "‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: $filename"
    echo "üìÅ –ü—É—Ç—å: $filepath"
}

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–ø—Ä–∏–Ω—Ç–∞
create_sprint_completion() {
    local sprint_num=$1
    if [ -z "$sprint_num" ]; then
        sprint_data=$(get_time_data "sprint")
        sprint_num=$(echo $sprint_data | cut -d',' -f1)
    fi
    
    local filename="SPRINT_${sprint_num}_COMPLETION_REPORT_$(date +%Y%m%d).md"
    local filepath="$REPORTS_DIR/sprints/$filename"
    
    cat > "$filepath" << EOF
# Sprint $sprint_num Completion Report

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: $(date '+%d %B %Y' | sed 's/July/–∏—é–ª—è/g')  
**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 5 –¥–Ω–µ–π  
**–ö–æ–º–∞–Ω–¥–∞**: AI Development Team

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ vs –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- **–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–¥–∞—á**: X
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á**: Y
- **–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: Z%

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–∞
- **–ù–∞–ø–∏—Å–∞–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**: X
- **–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤**: Y
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: Z%
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥**: —É–º–µ–Ω—å—à–µ–Ω/—É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ N%

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. [–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏]
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- **–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏**: X —á–∞—Å–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## üöß –ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. [–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏]
- **–°—Ç–∞—Ç—É—Å**: X% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- **–ü—Ä–∏—á–∏–Ω–∞**: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã
- **–ü–ª–∞–Ω**: –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ Sprint Y

## üí° –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 1
2. –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 2
3. –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 3

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

- **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: X —Å—Ç—Ä–æ–∫/—á–∞—Å
- **–°–∫–æ—Ä–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: Y —Ç–µ—Å—Ç–æ–≤/—á–∞—Å
- **–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤**: Z% –æ—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

## üîç –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
- **–†–µ—à–µ–Ω–∏–µ**: –ö–∞–∫ —Ä–µ—à–∏–ª–∏
- **–£—Ä–æ–∫–∏**: –ß—Ç–æ —É–∑–Ω–∞–ª–∏

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞

1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1
2. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2
3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 3

---

**Sprint $sprint_num –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!**
EOF

    echo "‚úÖ –°–æ–∑–¥–∞–Ω –æ—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ Sprint $sprint_num"
    echo "üìÅ –ü—É—Ç—å: $filepath"
}

# –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
show_info() {
    python3 "$SCRIPT_DIR/project-time.py"
}

# –û–±–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–π –¥–µ–Ω—å
update_day() {
    local day=$1
    if [ -z "$day" ]; then
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 set-day <–Ω–æ–º–µ—Ä_–¥–Ω—è>"
        return 1
    fi
    python3 "$SCRIPT_DIR/project-time.py" set-day $day
}

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
sync_time() {
    python3 "$SCRIPT_DIR/project-time.py" sync
}

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
case "$1" in
    "daily")
        create_daily_report
        ;;
    "sprint-completion")
        create_sprint_completion $2
        ;;
    "info")
        show_info
        ;;
    "set-day")
        update_day $2
        ;;
    "sync")
        sync_time
        ;;
    *)
        echo "Report Generator v2.0 - —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–µ–º"
        echo
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <–∫–æ–º–∞–Ω–¥–∞> [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]"
        echo
        echo "–ö–æ–º–∞–Ω–¥—ã:"
        echo "  daily              - –°–æ–∑–¥–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç"
        echo "  sprint-completion  - –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–ø—Ä–∏–Ω—Ç–∞"
        echo "  info              - –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–µ–º–µ–Ω–∏"
        echo "  set-day <–¥–µ–Ω—å>    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–π –¥–µ–Ω—å"
        echo "  sync              - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å report.sh"
        echo
        echo "–ü—Ä–∏–º–µ—Ä—ã:"
        echo "  $0 daily"
        echo "  $0 sprint-completion 29"
        echo "  $0 set-day 135"
        echo "  $0 info"
        ;;
esac 