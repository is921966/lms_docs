#!/bin/bash

echo "üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Provisioning Profile"
echo "========================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ñ–∞–π–ª—ã
if [ -f .temp-cicd/profile_base64.txt ]; then
    echo "‚úÖ –§–∞–π–ª profile_base64.txt —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"
    echo "   –ü—É—Ç—å: .temp-cicd/profile_base64.txt"
    exit 0
fi

echo "üì± Provisioning Profile –Ω–µ –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
echo "–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –ï—Å—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–µ—à–µ–Ω–∏—è:"
echo ""
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo "–í–ê–†–ò–ê–ù–¢ 1: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚≠ê"
echo "-----------------------------------------"
echo "GitHub Actions –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å provisioning profiles!"
echo ""
echo "–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub –ø—Ä–æ—Å—Ç–æ:"
echo "‚Ä¢ –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ BUILD_PROVISION_PROFILE_BASE64 –ø—É—Å—Ç—ã–º"
echo "‚Ä¢ –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –∑–Ω–∞—á–µ–Ω–∏–∏: skip"
echo ""
echo "CI/CD –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏."
echo ""
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo "–í–ê–†–ò–ê–ù–¢ 2: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é"
echo "-----------------------------------"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ https://developer.apple.com"
echo "2. Certificates, IDs & Profiles ‚Üí Profiles"
echo "3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π App Store profile"
echo "4. –°–∫–∞—á–∞–π—Ç–µ –µ–≥–æ"
echo ""

read -p "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç (1 - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, 2 - —Å–æ–∑–¥–∞—Ç—å): " choice

if [ "$choice" = "1" ]; then
    # –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä—É–≥–∞–ª—Å—è
    mkdir -p .temp-cicd
    echo "skip" > .temp-cicd/profile_base64.txt
    echo ""
    echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ."
    echo ""
    echo "–í GitHub Secrets –¥–ª—è BUILD_PROVISION_PROFILE_BASE64 —É–∫–∞–∂–∏—Ç–µ: skip"
elif [ "$choice" = "2" ]; then
    echo ""
    echo "–°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —Å developer.apple.com –∏ –ø–æ–ª–æ–∂–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ó–∞–≥—Ä—É–∑–∫–∏"
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ —Å–∫–∞—á–∞–ª–∏..."
    
    # –ò—â–µ–º —Å–∫–∞—á–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
    PROFILE=$(ls -t ~/Downloads/*.mobileprovision 2>/dev/null | head -1)
    if [ -f "$PROFILE" ]; then
        mkdir -p .temp-cicd
        cp "$PROFILE" .temp-cicd/profile.mobileprovision
        base64 -i "$PROFILE" -o .temp-cicd/profile_base64.txt
        echo "‚úÖ Provisioning Profile –æ–±—Ä–∞–±–æ—Ç–∞–Ω!"
    else
        echo "‚ùå –§–∞–π–ª .mobileprovision –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ó–∞–≥—Ä—É–∑–∫–∞—Ö"
    fi
fi

echo ""
echo "üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:"
echo "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–∑ github-secrets.txt" 